<%- include('partials/header') %> <%- include('partials/nav') %>

<main class="container movie-details-container">
  <a href="/catalog" class="back-button">← Voltar</a>
  <div class="movie-content">
    <img
      src="<%= movie.poster || 'https://via.placeholder.com/400x600.png?text=No+Image' %>"
      alt="Pôster de <%= movie.title %>"
      class="movie-poster-large"
    />
    <div class="movie-details-info">
      <h1><%= movie.title %></h1>
      <p><strong>Ano:</strong> <%= movie.year %></p>
      <p><strong>Gênero:</strong> <%= movie.genres.join(', ') %></p>
      <p><strong>Diretor:</strong> <%= movie.director %></p>
      <p><strong>Elenco:</strong> <%= movie.cast.join(', ') %></p>
      <p><strong>Avaliação:</strong> ⭐ <%= movie.rating %></p>
      <h3>Sinopse</h3>
      <p><%= movie.synopsis %></p>
    </div>
  </div>

  <div class="user-reviews">
    <h3>Avaliações dos Usuários</h3>
    <% comments.forEach(comment => { %>
    <div class="review">
      <strong><%= comment.username || 'Utilizador Removido' %></strong>
      <span>⭐ <%= comment.commentRating %></span>
      <p><%= comment.comment %></p>
    </div>
    <% }) %>
  </div>

  <% if (session.user) { %>
  <div class="add-review-section">
    <h3>Deixe sua Avaliação</h3>
    <form
      action="/movie/<%= movie.id %>/comment"
      method="POST"
      class="review-form"
    >
      <div class="form-group star-rating">
        <input type="radio" id="star5" name="commentRating" value="5" /><label
          for="star5"
          title="5 estrelas"
          >★</label
        >
        <input type="radio" id="star4" name="commentRating" value="4" /><label
          for="star4"
          title="4 estrelas"
          >★</label
        >
        <input type="radio" id="star3" name="commentRating" value="3" /><label
          for="star3"
          title="3 estrelas"
          >★</label
        >
        <input type="radio" id="star2" name="commentRating" value="2" /><label
          for="star2"
          title="2 estrelas"
          >★</label
        >
        <input
          type="radio"
          id="star1"
          name="commentRating"
          value="1"
          required
        /><label for="star1" title="1 estrela">★</label>
      </div>
      <div class="form-group">
        <label for="comment">Seu comentário:</label>
        <textarea
          id="comment"
          name="comment"
          rows="4"
          required
          placeholder="Escreva o que você achou do filme..."
        ></textarea>
      </div>
      <button type="submit" class="btn btn-primary">Enviar Avaliação</button>
    </form>
  </div>
  <% } else { %>
  <div class="review-login-prompt">
    <p><a href="/">Faça login</a> para deixar sua avaliação.</p>
  </div>
  <% } %>
</main>

<%- include('partials/footer') %>
